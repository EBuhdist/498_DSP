/*
 * nco.c
 *
 *  Numerically controlled oscillator
 *    This is a digital signal generator that uses a LUT (sinLUT) to contain one complete cycle
 *    of a sin wave, and uses a Phase Accumulator (pa) to index said LUT
 *
 *    Desired frequencies of sin wave are 1kHz & 2kHz
 */
#include "nco.h"

int16_t lut[512] = { 0, 402, 804, 1206, 1608, 2010, 2411, 2812, 3212, 3612,
		4012, 4411, 4809, 5206, 5603, 5999, 6394, 6787, 7180, 7572, 7963, 8352,
		8741, 9128, 9513, 9897, 10280, 10661, 11041, 11418, 11794, 12169, 12541,
		12912, 13281, 13647, 14012, 14374, 14735, 15093, 15449, 15802, 16153,
		16502, 16848, 17192, 17533, 17871, 18207, 18540, 18870, 19198, 19522,
		19844, 20162, 20478, 20790, 21099, 21405, 21708, 22008, 22304, 22597,
		22887, 23173, 23455, 23735, 24010, 24282, 24550, 24815, 25075, 25332,
		25586, 25835, 26080, 26322, 26559, 26793, 27022, 27248, 27469, 27686,
		27899, 28108, 28313, 28513, 28709, 28901, 29088, 29271, 29450, 29624,
		29794, 29959, 30119, 30276, 30427, 30574, 30717, 30854, 30987, 31116,
		31240, 31359, 31473, 31582, 31687, 31787, 31883, 31973, 32059, 32140,
		32215, 32287, 32353, 32414, 32471, 32522, 32569, 32611, 32648, 32680,
		32707, 32729, 32746, 32758, 32766, 32767, 32765, 32758, 32746, 32728,
		32706, 32679, 32647, 32610, 32568, 32521, 32469, 32412, 32351, 32284,
		32213, 32137, 32056, 31970, 31880, 31784, 31684, 31579, 31469, 31355,
		31236, 31112, 30983, 30850, 30712, 30569, 30422, 30270, 30114, 29953,
		29788, 29618, 29444, 29265, 29082, 28895, 28703, 28507, 28306, 28101,
		27892, 27679, 27462, 27240, 27015, 26785, 26552, 26314, 26072, 25827,
		25577, 25324, 25067, 24806, 24541, 24273, 24001, 23725, 23446, 23163,
		22877, 22588, 22294, 21998, 21698, 21395, 21089, 20780, 20467, 20152,
		19833, 19511, 19187, 18859, 18529, 18196, 17860, 17522, 17180, 16837,
		16490, 16142, 15790, 15437, 15081, 14723, 14362, 14000, 13635, 13268,
		12900, 12529, 12156, 11782, 11406, 11028, 10648, 10267, 9885, 9500,
		9115, 8728, 8340, 7950, 7559, 7167, 6774, 6380, 5985, 5590, 5193, 4795,
		4397, 3998, 3599, 3199, 2798, 2398, 1996, 1595, 1193, 791, 389, -12,
		-415, -817, -1219, -1620, -2022, -2423, -2824, -3225, -3624, -4024,
		-4423, -4821, -5218, -5615, -6011, -6406, -6800, -7192, -7584, -7975,
		-8364, -8753, -9140, -9525, -9909, -10292, -10673, -11052, -11430,
		-11806, -12180, -12553, -12923, -13292, -13658, -14023, -14385, -14746,
		-15104, -15459, -15813, -16164, -16512, -16859, -17202, -17543, -17881,
		-18217, -18550, -18880, -19207, -19532, -19853, -20172, -20487, -20799,
		-21109, -21415, -21717, -22017, -22313, -22606, -22895, -23181, -23464,
		-23743, -24018, -24290, -24558, -24822, -25083, -25340, -25593, -25842,
		-26087, -26329, -26566, -26800, -27029, -27254, -27476, -27693, -27905,
		-28114, -28319, -28519, -28715, -28906, -29093, -29276, -29455, -29629,
		-29798, -29963, -30124, -30280, -30431, -30578, -30720, -30858, -30991,
		-31119, -31243, -31361, -31476, -31585, -31690, -31790, -31885, -31975,
		-32060, -32141, -32217, -32288, -32354, -32415, -32472, -32523, -32569,
		-32611, -32648, -32680, -32707, -32728, -32746, -32758, -32765, -32767,
		-32764, -32757, -32744, -32727, -32704, -32677, -32644, -32607, -32565,
		-32518, -32466, -32409, -32348, -32281, -32210, -32133, -32052, -31966,
		-31875, -31780, -31679, -31574, -31464, -31350, -31230, -31106, -30978,
		-30844, -30706, -30564, -30416, -30264, -30108, -29947, -29782, -29612,
		-29437, -29258, -29075, -28887, -28695, -28499, -28298, -28094, -27884,
		-27671, -27454, -27232, -27006, -26777, -26543, -26305, -26063, -25817,
		-25568, -25314, -25057, -24796, -24531, -24263, -23991, -23715, -23436,
		-23153, -22867, -22577, -22284, -21987, -21687, -21384, -21078, -20768,
		-20456, -20140, -19821, -19500, -19175, -18847, -18517, -18184, -17848,
		-17509, -17168, -16824, -16478, -16129, -15778, -15424, -15068, -14710,
		-14349, -13987, -13622, -13255, -12886, -12516, -12143, -11769, -11392,
		-11014, -10635, -10254, -9871, -9487, -9101, -8714, -8326, -7936, -7545,
		-7153, -6760, -6366, -5971, -5575, -5179, -4781, -4383, -3984, -3585,
		-3185, -2784, -2383, -1982, -1580, -1179, -777, -374 };

uint32_t pa = 0;
uint32_t index = 0;

int16_t signalGenerator(float freq) {

	const float rate = 89478.4853333; //rate of change for 48 ksmp/s at 32 bits (2^32/48000)

	//rate of change at designated frequency
	int32_t k = (int32_t) (freq * rate);

	pa = pa + k;
	index = pa >> 23; //pa is shifted because index N = 9 and there are 32 bits total

	return lut[index];

}
